(this["webpackJsonptramways-ui"]=this["webpackJsonptramways-ui"]||[]).push([[0],{301:function(e,n,t){},303:function(e,n,t){"use strict";t.r(n);var r=t(1),a=t(13),c=t(0),i=t.n(c),o=t(6),l=t(369),u=t(370),s=t(307),j=t(49),d=t(304),b=t(382),O=t(305),f=t(372),v=t(362),p=t(346),h=t(132),x=t.n(h),m=t(129),C=t.n(m),g=t(131),y=t.n(g),k=t(130),S=t.n(k),I=t(41),w=i.a.createContext({}),N=t(31),T=t.n(N),E=t(46),A=t(377),M=t(345),D=t(341),P=t(338),U=t(376),R="relative",L=Object(P.a)((function(e){e.palette;var n=e.spacing;return Object(U.a)({appBarTitle:{flexGrow:1},fab:{position:"absolute",top:n(2),right:n(2)},relative:{position:R},container:{position:R,marginTop:n(2)},centerContent:{width:"100%",display:"flex",alignItems:"center",flexDirection:"column"},card:{padding:n(1)},formControl:{margin:n(1),minWidth:120}})})),B=function(e){var n=e.title,t=e.children,a=L(),o=Object(c.useContext)(w).setAppBarTitle;return Object(c.useEffect)((function(){o(n)}),[o,n]),Object(r.jsx)(D.a,{className:a.container,children:i.a.Children.toArray(t)})},W=t(125),G=t.n(W),z=i.a.createContext({});function F(e){var n=e.navigate,t=Object(c.useContext)(z),a=t.usersApi,i=t.updateToken,l=L(),u=Object(c.useState)(""),s=Object(o.a)(u,2),j=s[0],b=s[1],O=Object(c.useState)(""),f=Object(o.a)(O,2),v=f[0],p=f[1];function h(){return(h=Object(E.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.login({username:j,password:v}).then((function(e){i(e.data.value),n&&n("/tramways/profile")}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.jsx)(B,{title:"Login",children:Object(r.jsxs)("div",{className:l.centerContent,children:[Object(r.jsx)("div",{children:Object(r.jsx)(A.a,{className:l.formControl,variant:"outlined",label:"Username",value:j,onChange:function(e){return b(e.target.value)}})}),Object(r.jsx)("div",{children:Object(r.jsx)(A.a,{variant:"outlined",className:l.formControl,value:v,label:"Password",onChange:function(e){return p(e.target.value)},type:"password"})}),Object(r.jsx)("div",{children:Object(r.jsx)(M.a,{className:l.formControl,children:Object(r.jsx)(d.a,{startIcon:Object(r.jsx)(G.a,{}),variant:"contained",color:"primary",onClick:function(){return h.apply(this,arguments)},children:"Submit"})})})]})})}var H=t(352),J=t(353),V=t(354),q=t(355),K=t(356),Y=t(52),Q=t.n(Y),X=t(348),Z=t(349),$=t(350),_=t(351),ee=t(379),ne=t(373),te=t(347);function re(e){var n=e.optionId,t=void 0===n?function(e){return e}:n,a=e.optionLabel,l=void 0===a?function(e){return e}:a,u=e.options,s=e.value,j=e.className,d=e.label,b=e.multiSelect,O=e.onSelectOption,f=Object(c.useRef)(null),v=i.a.useState(0),p=Object(o.a)(v,2),h=p[0],x=p[1];return Object(c.useEffect)((function(){x(f.current?f.current.offsetWidth:0)}),[]),Object(r.jsxs)(M.a,{variant:"outlined",className:j,children:[Object(r.jsx)(ee.a,{ref:f,children:d}),Object(r.jsx)(ne.a,{MenuProps:{anchorOrigin:{horizontal:"left",vertical:"bottom"},transformOrigin:{horizontal:"left",vertical:"top"},getContentAnchorEl:null},multiple:b,onChange:function(e){return O(e.target.value)},value:s,labelWidth:h,children:u.map((function(e){return Object(r.jsx)(te.a,{value:e,children:l(e)},t(e))}))})]})}var ae=t(30);function ce(e){var n=e.user,t=e.onClose,a=e.onConfirm,i=Object(c.useContext)(z).usersApi,l=Object(c.useState)(n.username),u=Object(o.a)(l,2),s=u[0],j=u[1],b=Object(c.useState)(""),O=Object(o.a)(b,2),f=O[0],v=O[1],p=Object(c.useState)(""),h=Object(o.a)(p,2),x=h[0],m=h[1],C=Object(c.useState)(n.roles||[]),g=Object(o.a)(C,2),y=g[0],k=g[1],S=L();return Object(r.jsxs)(X.a,{maxWidth:"sm",fullWidth:!0,onClose:t,open:!!n,children:[Object(r.jsx)(Z.a,{children:(null===n||void 0===n?void 0:n.uuid)?"Edit user ".concat(null===n||void 0===n?void 0:n.username):"Create user"}),Object(r.jsx)($.a,{children:Object(r.jsxs)("div",{className:"flex-column",children:[!(null===n||void 0===n?void 0:n.uuid)&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(A.a,{className:S.formControl,variant:"outlined",label:"Username",value:s,onChange:function(e){return j(e.target.value)}}),Object(r.jsx)(A.a,{className:S.formControl,variant:"outlined",value:f,label:"Password",onChange:function(e){return v(e.target.value)},type:"password"}),Object(r.jsx)(A.a,{className:S.formControl,variant:"outlined",value:x,label:"Confirm password",onChange:function(e){return m(e.target.value)},error:x!==f,helperText:x!==f&&"Not matching passwords",type:"password"})]}),Object(r.jsx)(re,{className:S.formControl,label:"Roles",options:Object.values(ae.UserRole),optionId:function(e){return e.toString()},optionLabel:function(e){return e.toString()},value:y,onSelectOption:k,multiSelect:!0})]})}),Object(r.jsxs)(_.a,{children:[Object(r.jsx)(d.a,{variant:"text",color:"primary",onClick:t,children:"Close"}),Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){n.uuid?i.editRoles(n.uuid,y).then(a):f===x&&i.createUser({username:s,password:f,roles:y}).then(a)},children:"Confirm"})]})]})}function ie(e){var n=Object(c.useContext)(z).usersApi,t=L(),a=Object(c.useState)([]),i=Object(o.a)(a,2),l=i[0],u=i[1],s=Object(c.useCallback)((function(){n.getUsers().then((function(e){return u(e.data)}))}),[n]);Object(c.useEffect)((function(){s()}),[s]);var b=Object(c.useState)(null),O=Object(o.a)(b,2),f=O[0],v=O[1];return Object(r.jsxs)(B,{title:"Users",children:[Object(r.jsx)(H.a,{color:"primary","aria-label":"add",className:t.fab,onClick:function(){v({username:"",roles:[ae.UserRole.Client]})},children:Object(r.jsx)(Q.a,{})}),Object(r.jsx)(J.a,{container:!0,spacing:1,children:l&&l.map((function(e){return Object(r.jsx)(J.a,{item:!0,xs:4,children:Object(r.jsxs)(V.a,{className:t.card,children:[Object(r.jsxs)(q.a,{children:[Object(r.jsx)(j.a,{variant:"h5",children:e.username}),Object(r.jsx)(j.a,{variant:"h6",children:"Roles: ".concat(e&&e.roles&&e.roles.join(", "))})]}),Object(r.jsxs)(K.a,{children:[Object(r.jsx)(d.a,{variant:"outlined",color:"primary",onClick:function(){return v(e)},children:"Edit"}),Object(r.jsx)(d.a,{color:"primary",onClick:function(){var t;(t=e.uuid)&&n.deleteUser(t).then((function(){return s()}))},children:"Delete"})]})]})},e.uuid)}))}),f&&Object(r.jsx)(ce,{user:f,onClose:function(){return v(null)},onConfirm:function(){v(null),s()}})]})}var oe=i.a.createContext({});function le(e){var n=e.title,t=e.visible,a=e.onClose,c=e.children,i=e.buttonColor,o=void 0===i?"secondary":i;return Object(r.jsxs)(X.a,{open:t,onClose:a,children:[n&&Object(r.jsx)(Z.a,{children:n}),Object(r.jsx)($.a,{children:c}),a&&Object(r.jsx)(_.a,{children:Object(r.jsx)(d.a,{variant:"contained",color:o,onClick:a,children:"Chiudi"})})]})}var ue=t(371),se=t(375),je=t(357),de=t(359),be=t(358);function Oe(e){e.navigate;var n=Object(c.useContext)(z).usersApi,t=Object(c.useContext)(w).notifyMessage,a=Object(c.useState)(""),i=Object(o.a)(a,2),l=i[0],u=i[1],s=Object(c.useState)(""),b=Object(o.a)(s,2),O=b[0],f=b[1],v=Object(c.useState)(""),p=Object(o.a)(v,2),h=p[0],x=p[1],m=Object(c.useContext)(oe).user;function C(){return(C=Object(E.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:m&&O===h&&n.editPassword(m.uuid||"",{oldPassword:l,newPassword:O}).then((function(){return t("Password changed successfully")}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return m?Object(r.jsxs)(B,{title:m.username+" profile",children:[Object(r.jsx)(j.a,{variant:"h2",children:"Your profile"}),Object(r.jsxs)(se.a,{children:[Object(r.jsx)(je.a,{expandIcon:Object(r.jsx)(be.a,{}),children:Object(r.jsx)(j.a,{variant:"h6",children:"Password change"})}),Object(r.jsx)(de.a,{children:Object(r.jsxs)("div",{className:"flex-column",children:[Object(r.jsx)("div",{className:"spaced-top-10",children:Object(r.jsx)(A.a,{type:"password",label:"Old password",variant:"outlined",onChange:function(e){return u(e.target.value)},value:l})}),Object(r.jsx)("div",{className:"spaced-top-10",children:Object(r.jsx)(A.a,{type:"password",label:"New password",variant:"outlined",onChange:function(e){return f(e.target.value)},value:O})}),Object(r.jsx)("div",{className:"spaced-top-10",children:Object(r.jsx)(A.a,{type:"password",label:"Confirm new password",variant:"outlined",onChange:function(e){return x(e.target.value)},value:h,error:O!==h,helperText:O!==h&&"Not matching passwords"})}),Object(r.jsx)("div",{className:"spaced-top-10",children:Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){return C.apply(this,arguments)},children:"Change password"})})]})})]})]}):null}var fe=function(e){var n=e.title,t=e.valid,a=void 0===t||t,c=e.children,i=e.size,o=e.visible,l=e.onCancel,u=e.onOk,s=e.cancelText,j=void 0===s?"Cancel":s,b=e.okText,O=void 0===b?"Ok":b;return Object(r.jsxs)(X.a,{open:o,onClose:l,maxWidth:i,fullWidth:!!i,children:[n&&Object(r.jsx)(Z.a,{children:n}),Object(r.jsx)($.a,{dividers:!0,children:c}),Object(r.jsxs)(_.a,{children:[Object(r.jsx)(d.a,{color:"primary",onClick:l,children:j}),Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:u,disabled:!a,children:O})]})]})};function ve(e){var n=e.project,t=e.onAbort,a=e.onConfirm,i=Object(c.useContext)(z).projectsApi,l=Object(c.useState)(n.name),u=Object(o.a)(l,2),s=u[0],j=u[1];return Object(r.jsx)(fe,{onOk:function(){n.uuid?i.updateProject(n.uuid,{name:s}).then(a):i.createProject({name:s}).then(a)},onCancel:t,visible:!0,children:Object(r.jsx)(A.a,{variant:"outlined",label:"Project name",onChange:function(e){return j(e.target.value)},value:s})})}function pe(e){var n=e.navigate,t=L(),a=Object(c.useContext)(z).projectsApi,i=Object(c.useState)([]),l=Object(o.a)(i,2),u=l[0],s=l[1],b=Object(c.useCallback)((function(){a.getProjects().then((function(e){return s(e.data)}))}),[a]);Object(c.useEffect)((function(){b()}),[b]);var O=Object(c.useState)(null),f=Object(o.a)(O,2),v=f[0],p=f[1];if(!u)return null;var h=function(e){return e.roadMaps&&e.roadMaps.map((function(e){return Object(r.jsx)(j.a,{variant:"h6",children:e.name})})),[]};return Object(r.jsxs)(B,{title:"Projects",children:[Object(r.jsx)(H.a,{className:t.fab,color:"primary",onClick:function(){return p({name:""})},children:Object(r.jsx)(Q.a,{})}),Object(r.jsx)(J.a,{container:!0,spacing:1,children:u.map((function(e){return Object(r.jsx)(J.a,{item:!0,xs:4,children:Object(r.jsxs)(V.a,{className:t.card,children:[Object(r.jsxs)(q.a,{children:[Object(r.jsx)(j.a,{variant:"h5",children:e.name}),h(e)]}),Object(r.jsxs)(K.a,{children:[Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){return function(e){n&&e.uuid&&n(e.uuid)}(e)},children:"Open"}),Object(r.jsx)(d.a,{color:"primary",onClick:function(){return function(e){p(e)}(e)},children:"Edit"}),Object(r.jsx)(d.a,{onClick:function(){return function(e){e.uuid&&a.deleteProject(e.uuid).then((function(){return b()}))}(e)},children:"Delete"})]})]})},null===e||void 0===e?void 0:e.uuid)}))}),v&&Object(r.jsx)(ve,{project:v,onConfirm:function(){p(null),b()},onAbort:function(){return p(null)}})]})}var he=t(7);function xe(e){var n=e.project,t=e.map,a=e.refresh,i=e.navigate,l=Object(c.useContext)(z).projectsApi,u=L(),s=Object(c.useRef)(null);var b=Object(c.useState)(!1),O=Object(o.a)(b,2),f=O[0],v=O[1],p=Object(c.useState)(""),h=Object(o.a)(p,2),x=h[0],m=h[1],C=function(){return v(!1)};function g(){return(g=Object(E.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&n.uuid&&t&&t.uuid&&l.deleteMap(n.uuid,t.uuid).then((function(){return a()}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(){return(y=Object(E.a)(T.a.mark((function e(){return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&n.uuid&&l.createMap(n.uuid,{map:Object(he.a)(Object(he.a)({},t),{},{name:x})}).then((function(){m(""),C(),a()}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(c.useEffect)((function(){var e;f&&(null===s||void 0===s||null===(e=s.current)||void 0===e||e.focus())}),[f]),Object(r.jsxs)(V.a,{className:u.card,children:[Object(r.jsx)(q.a,{children:Object(r.jsx)(j.a,{variant:"h5",children:t.name})}),Object(r.jsxs)(K.a,{children:[Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){i&&t.uuid&&i(t.uuid)},children:"Open"}),Object(r.jsx)(d.a,{variant:"outlined",color:"primary",onClick:function(){t&&t.name&&(v(!0),m(t.name))},children:"Duplicate"}),Object(r.jsx)(d.a,{onClick:function(){return function(){return g.apply(this,arguments)}()},children:"Delete"})]}),Object(r.jsx)(fe,{visible:f,onCancel:C,onOk:function(){return y.apply(this,arguments)},children:Object(r.jsx)(A.a,{variant:"outlined",ref:s,label:"New map name",value:x,onChange:function(e){return m(e.target.value)}})})]})}function me(e){var n=e.projectId,t=e.map,a=e.onAbort,i=e.onConfirm,l=Object(c.useContext)(z).projectsApi,u=Object(c.useState)(t.name),s=Object(o.a)(u,2),j=s[0],d=s[1];return Object(r.jsx)(fe,{onOk:function(){t.uuid?l.updateMap(n,t.uuid,{map:Object(he.a)(Object(he.a)({},t),{},{name:j})}).then(i):l.createMap(n,{map:{name:j,points:[],lanes:[]}}).then(i)},onCancel:a,visible:!0,children:Object(r.jsx)(A.a,{variant:"outlined",label:"Map name",onChange:function(e){return d(e.target.value)},value:j})})}function Ce(e){var n=e.navigate,t=e.projectId,a=L(),i=Object(c.useContext)(z).projectsApi,l=Object(c.useState)(null),u=Object(o.a)(l,2),s=u[0],j=u[1],d=Object(c.useState)(null),b=Object(o.a)(d,2),O=b[0],f=b[1],v=Object(c.useCallback)((function(){t&&i.getProject(t).then((function(e){return j(e.data)}))}),[t,i]);Object(c.useEffect)((function(){v()}),[v]);var p=[];return s&&s.roadMaps&&s.roadMaps.forEach((function(e){return p.push(Object(r.jsx)(J.a,{item:!0,xs:12,sm:6,md:4,lg:3,xl:3,children:Object(r.jsx)(xe,{project:s,map:e,refresh:v,navigate:n})},e.uuid))})),Object(r.jsxs)(B,{title:"Project ".concat(null===s||void 0===s?void 0:s.name),children:[Object(r.jsx)(H.a,{className:a.fab,color:"primary",onClick:function(){return f({name:"",lanes:[],points:[]})},children:Object(r.jsx)(Q.a,{})}),Object(r.jsx)(J.a,{container:!0,spacing:1,children:p}),t&&O&&Object(r.jsx)(me,{projectId:t,map:O,onConfirm:function(){f(null),v()},onAbort:function(){return f(null)}})]})}var ge=t(126),ye=t.n(ge),ke=function(e){var n=e.initialJSON,t=e.onChange,a=e.onClose,i=(e.visible,Object(c.useState)({mode:"code"})),l=Object(o.a)(i,1)[0],u=Object(c.useState)(""),s=Object(o.a)(u,2),j=s[0],b=s[1],O=Object(c.useState)(),f=Object(o.a)(O,2),v=f[0],p=f[1],h=Object(c.useCallback)((function(e){null!==e&&p(new ye.a(e,l))}),[l]);return Object(c.useEffect)((function(){v&&v.set(n)}),[v,n]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("div",{className:"jsoneditor-container",ref:h}),v&&Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){try{t(v.get())}catch(e){b("Map not valid")}},children:"Save"}),Object(r.jsx)(d.a,{onClick:a,children:"Close"}),Object(r.jsx)(le,{onClose:function(){return b("")},visible:!!j,children:Object(r.jsx)("p",{children:j})})]})},Se=t(127),Ie=t.n(Se);function we(e,n){return e.find((function(e){return e.name===n}))}var Ne=t(54),Te=t(360),Ee=t(380),Ae=t(361);function Me(e){var n=e.visible,t=e.onCancel,a=e.onConfirm,i=Object(c.useState)(""),l=Object(o.a)(i,2),u=l[0],s=l[1];return Object(r.jsx)(fe,{onOk:function(){a({id:u,category:"RelevantPoint",configurableType:"RelevantPoint",props:[],links:[]})},onCancel:t,visible:n,children:Object(r.jsx)(A.a,{variant:"outlined",label:"ID",onChange:function(e){return s(e.target.value)},value:u})})}function De(e){var n=e.optionId,t=void 0===n?function(e){return e}:n,a=e.optionLabel,l=void 0===a?function(e){return e}:a,u=e.options,s=e.value,j=e.className,d=e.label,b=e.multiSelect,O=void 0!==b&&b,f=e.onSelectOption,v=L().formControl,p=Object(c.useRef)(null),h=i.a.useState(0),x=Object(o.a)(h,2),m=x[0],C=x[1];Object(c.useEffect)((function(){C(p.current?p.current.offsetWidth:0)}),[]);var g=j?"".concat(v," ").concat(j):v;return Object(r.jsxs)(M.a,{variant:"outlined",className:g,children:[Object(r.jsx)(ee.a,{ref:p,children:d}),Object(r.jsx)(ne.a,{MenuProps:{anchorOrigin:{horizontal:"left",vertical:"bottom"},transformOrigin:{horizontal:"left",vertical:"top"},getContentAnchorEl:null},multiple:O,onChange:function(e){return f(e.target.value?e.target.value:null)},value:s||"",labelWidth:m,children:u.map((function(e){return Object(r.jsx)(te.a,{value:e,children:l(e)},t(e))}))})]})}function Pe(e){return(null===e||void 0===e?void 0:e.points)||[]}function Ue(e){return(null===e||void 0===e?void 0:e.lanes)||[]}function Re(e){return e.props||(e.props=[]),e.props}function Le(e){var n=e.roadMap,t=e.visible,a=e.onCancel,i=e.onConfirm,l=L().formControl,u=Object(c.useState)(""),s=Object(o.a)(u,2),j=s[0],d=s[1],b=Object(c.useState)(null),O=Object(o.a)(b,2),f=O[0],v=O[1],p=Object(c.useState)(null),h=Object(o.a)(p,2),x=h[0],m=h[1];return Object(r.jsxs)(fe,{onOk:function(){i({id:j,category:"Lane",configurableType:"Lane",props:[],sourceId:f,destinationId:x})},onCancel:a,valid:!!(j&&f&&x&&f!==x),visible:t,children:[Object(r.jsx)(A.a,{className:l,variant:"outlined",label:"ID",onChange:function(e){return d(e.target.value)},value:j}),Object(r.jsx)(De,{options:Pe(n).map((function(e){return e.id||null})),value:f,label:"Source",onSelectOption:function(e){return v(e)}}),Object(r.jsx)(De,{options:Pe(n).map((function(e){return e.id||null})),value:x,label:"Destination",onSelectOption:function(e){return m(e)}})]})}var Be={INTEGER:"IntegerProperty",STRING:"StringProperty",DECIMAL:"DecimalProperty",CHOICE:"ChoiceProperty",DISTRIBUTION:"DistributionProperty"};function We(){return{name:"",value:"",propertyType:Be.STRING}}function Ge(e,n){return{propertyType:"DecimalProperty",name:e,value:n}}function ze(e){var n=e.roadMap,t=e.onClose,a=e.onCreateNode,i=e.onCreateLane,l=e.x,u=e.y,s=e.visible,j=Object(c.useState)(!1),b=Object(o.a)(j,2),f=b[0],h=b[1],x=Object(c.useState)(!1),m=Object(o.a)(x,2),C=m[0],g=m[1];return Object(r.jsxs)(X.a,{onClose:t,open:s,children:[Object(r.jsx)($.a,{children:Object(r.jsxs)(p.a,{children:[Object(r.jsxs)(O.a,{button:!0,onClick:function(){return h(!0)},children:[Object(r.jsx)(Te.a,{children:Object(r.jsx)(Ee.a,{children:Object(r.jsx)(Ae.a,{})})}),Object(r.jsx)(v.a,{primary:"Nuovo nodo"})]}),Object(r.jsxs)(O.a,{button:!0,onClick:function(){return g(!0)},children:[Object(r.jsx)(Te.a,{children:Object(r.jsx)(Ee.a,{children:Object(r.jsx)(Ae.a,{})})}),Object(r.jsx)(v.a,{primary:"Nuovo collegamento"})]})]})}),Object(r.jsx)(_.a,{children:Object(r.jsx)(d.a,{onClick:function(){return t()},children:"Close"})}),f&&Object(r.jsx)(Me,{visible:f,onCancel:function(){return h(!1)},onConfirm:function(e){return a(Object(he.a)(Object(he.a)({},e),{},{props:[].concat(Object(Ne.a)((null===e||void 0===e?void 0:e.props)||[]),[Ge("x",l),Ge("y",u)])}))}}),C&&Object(r.jsx)(Le,{roadMap:n,visible:C,onCancel:function(){return g(!1)},onConfirm:function(e){return i(e)}})]})}var Fe=t(367),He=t(364),Je=t(368),Ve=t(366),qe=t(381),Ke=t(363),Ye=t(374);function Qe(e){var n=e.configurations,t=e.onOk,a=e.onCancel,i=Object(c.useState)(null),l=Object(o.a)(i,2),u=l[0],s=l[1];return Object(r.jsx)(fe,{visible:!0,onCancel:a,onOk:function(){var e=n.find((function(e){return e.uuid===u}));t(e||null)},children:Object(r.jsx)(qe.a,{value:u,onChange:function(e){return s(e.target.value)},children:n.map((function(e,n){return Object(r.jsx)(Ke.a,{control:Object(r.jsx)(Ye.a,{value:e.uuid}),label:e.name},e.uuid)}))})})}function Xe(e){var n=e.property,t=e.onChange,a=L();return Object(r.jsx)(A.a,{type:"number",className:a.formControl,label:(null===n||void 0===n?void 0:n.description)||"Value",variant:"outlined",value:(null===n||void 0===n?void 0:n.value)||0,onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{value:parseInt(e.target.value)}))}})}function Ze(e){var n=e.property,t=e.onChange,a=L();return Object(r.jsx)(A.a,{className:a.formControl,label:(null===n||void 0===n?void 0:n.description)||"Value",variant:"outlined",value:(null===n||void 0===n?void 0:n.value)||"",onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{value:e.target.value}))}})}function $e(e){var n=e.property,t=e.onChange,a=L();return Object(r.jsx)(A.a,{type:"number",className:a.formControl,label:(null===n||void 0===n?void 0:n.description)||"Value",variant:"outlined",value:(null===n||void 0===n?void 0:n.value)||0,onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{value:parseFloat(e.target.value)}))}})}function _e(e){var n=e.property,t=e.onChange;return Object(r.jsx)(De,{optionId:function(e){return(null===e||void 0===e?void 0:e.id)||""},optionLabel:function(e){return(null===e||void 0===e?void 0:e.label)||""},options:(null===n||void 0===n?void 0:n.choices)||[],value:function(){var e;return(null===n||void 0===n||null===(e=n.choices)||void 0===e?void 0:e.find((function(e){return e.id===n.value})))||null}(),disabled:!1,label:(null===n||void 0===n?void 0:n.description)||"",multiSelect:!1,onSelectOption:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{value:null===e||void 0===e?void 0:e.id}))}})}function en(e){var n=e.distribution,t=e.onChange,a=L();return Object(r.jsxs)("div",{className:"flex-row",children:[Object(r.jsx)(A.a,{type:"number",className:a.formControl,label:"Min",variant:"outlined",value:(null===n||void 0===n?void 0:n.left)||0,onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{left:parseFloat(e.target.value)}))}}),Object(r.jsx)(A.a,{type:"number",className:a.formControl,label:"Max",variant:"outlined",value:(null===n||void 0===n?void 0:n.right)||0,onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{right:parseFloat(e.target.value)}))}})]})}function nn(e){var n=e.distribution,t=e.onChange,a=L();return Object(r.jsx)(A.a,{type:"number",className:a.formControl,label:"Lambda",variant:"outlined",value:(null===n||void 0===n?void 0:n.lambda)||0,onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{lambda:parseFloat(e.target.value)}))}})}function tn(e){var n,t=e.property,a=e.onChange,c=new Map;c.set("UniformDistribution",en),c.set("ExponentialDistribution",nn);var i=(null===t||void 0===t||null===(n=t.value)||void 0===n?void 0:n.distributionType)&&c.get(t.value.distributionType);return i||(i=function(){return Object(r.jsx)("p",{children:"Unsupported"})}),Object(r.jsx)(i,{distribution:t.value,onChange:function(e){a(Object(he.a)(Object(he.a)({},t),{},{value:e}))}})}function rn(e){var n=e.property,t=e.onChange,a=new Map;a.set(Be.INTEGER,Xe),a.set(Be.DECIMAL,$e),a.set(Be.STRING,Ze),a.set(Be.CHOICE,_e),a.set(Be.DISTRIBUTION,tn);var c=a.get(n.propertyType);return c||(c=function(){return Object(r.jsx)("p",{children:"Unsupported"})}),Object(r.jsxs)("div",{children:[Object(r.jsx)(j.a,{variant:"h5",children:n.name}),Object(r.jsx)(c,{property:n,onChange:t})]})}var an=t(365);function cn(e){var n=e.properties,t=e.onOk,a=e.onCancel,i=Object(c.useState)(null),l=Object(o.a)(i,2),u=l[0],s=l[1];return Object(r.jsx)(fe,{visible:!0,onCancel:a,onOk:function(){var e=n.find((function(e){return e.name===u}))||null;t(e)},children:Object(r.jsx)(qe.a,{value:u,onChange:function(e){return s(e.target.value)},children:n.map((function(e,n){return Object(r.jsx)(Ke.a,{control:Object(r.jsx)(Ye.a,{value:e.name}),label:e.name},e.name+""+n)}))})})}var on=new Map;function ln(e){var n=e.property,t=e.onChange,a=e.suggestions,i=void 0===a?[]:a,l=Object(c.useState)(!1),u=Object(o.a)(l,2),j=u[0],d=u[1],b=L().formControl,O=Object(c.useState)(!1),f=Object(o.a)(O,2),v=f[0],p=f[1];function h(e){switch(e){case Be.INTEGER:t({name:"",value:0,propertyType:Be.INTEGER});break;case Be.DECIMAL:t({name:"",value:0,propertyType:Be.DECIMAL});break;case Be.CHOICE:t({name:"",value:void 0,choices:[],propertyType:Be.CHOICE});break;case Be.DISTRIBUTION:t({name:"",value:{distributionType:"UniformDistributionType",left:0,right:1},propertyType:Be.DISTRIBUTION});break;case Be.STRING:default:t(We())}}var x=on.get(n.propertyType);return x||(x=function(){return Object(r.jsx)("p",{children:"Unsupported"})}),Object(r.jsxs)("div",{className:"flex-row flex-grow justify-space-between",children:[Object(r.jsx)(De,{className:"flex-grow",options:Object.values(Be),value:n&&n.propertyType,label:"Property type",onSelectOption:function(e){return h(e)}}),Object(r.jsx)(A.a,{className:b,label:"Name",variant:"outlined",value:(null===n||void 0===n?void 0:n.name)||"",onChange:function(e){return t(Object(he.a)(Object(he.a)({},n),{},{name:e.target.value}))},InputProps:{endAdornment:Object(r.jsx)(an.a,{position:"end",children:Object(r.jsx)(s.a,{onClick:function(){return p(!0)},children:Object(r.jsx)(Ve.a,{})})})}}),Object(r.jsx)(s.a,{onClick:function(){return d(!0)},children:Object(r.jsx)(Fe.a,{})}),Object(r.jsx)(le,{title:(null===n||void 0===n?void 0:n.name)+" content editing",visible:j,onClose:function(){return d(!1)},buttonColor:"default",children:Object(r.jsx)(x,{property:n,onChange:t})}),v&&Object(r.jsx)(cn,{properties:i,onOk:function(e){e&&(p(!1),t(Object(he.a)({},e)))},onCancel:function(){return p(!1)}})]})}function un(e){var n=e.suggestions,t=void 0===n?[]:n,a=e.visible,i=e.onCancel,l=e.onOk,u=Object(c.useState)(We()),s=Object(o.a)(u,2),j=s[0],d=s[1];return Object(r.jsx)(fe,{title:"Property creation",visible:a,onCancel:i,onOk:function(){l(j),d(We())},children:Object(r.jsx)(ln,{property:j,onChange:function(e){return d(e)},suggestions:t})})}function sn(e){var n=e.element,t=e.onChange,a=Object(c.useState)([]),i=Object(o.a)(a,1)[0],l=Object(c.useState)(!1),u=Object(o.a)(l,2),j=u[0],b=u[1],O=Object(c.useState)(!1),f=Object(o.a)(O,2),v=f[0],p=f[1],h=i.flatMap((function(e){return e.props||[]}));function x(e,r){var a=Re(n);t(Object(he.a)(Object(he.a)({},n),{},{props:a.slice(0,e).concat([r]).concat(a.slice(e+1,a.length))}))}return h=h.filter((function(e,n){return h.findIndex((function(n){return(null===n||void 0===n?void 0:n.name)===(null===e||void 0===e?void 0:e.name)}))===n})),Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:"flex-row justify-space-between",children:Object(r.jsxs)(Je.a,{children:[Object(r.jsx)(d.a,{color:"primary",variant:"outlined",onClick:function(){return p(!0)},endIcon:Object(r.jsx)(Ae.a,{}),children:"Add"}),Object(r.jsx)(d.a,{color:"primary",variant:"outlined",onClick:function(){return b(!0)},endIcon:Object(r.jsx)(Ve.a,{}),children:"Add from preset"})]})}),Re(n).map((function(e,a){return Object(r.jsxs)("div",{className:"flex-row justify-space-between",children:[Object(r.jsx)(rn,{property:e,onChange:function(e){return x(a,e)}}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return function(e){var r=Re(n);t(Object(he.a)(Object(he.a)({},n),{},{props:r.slice(0,e).concat(r.slice(e+1,r.length))}))}(a)},children:Object(r.jsx)(He.a,{})})]},e.name||""+a)})),j&&Object(r.jsx)(Qe,{configurations:i,onCancel:function(){return b(!1)},onOk:function(e){return function(e){b(!1);var r=Object(Ne.a)(Re(n));((null===e||void 0===e?void 0:e.props)||[]).forEach((function(e){var n=r.findIndex((function(n){return n.name===e.name}));r=n>=0?r.slice(0,n).concat([e]).concat(r.slice(n+1,r.length)):r.concat([e])})),t(Object(he.a)(Object(he.a)({},n),{},{props:r}))}(e)}}),v&&Object(r.jsx)(un,{suggestions:h||[],onOk:function(e){t(Object(he.a)(Object(he.a)({},n),{},{props:Re(n).concat([e])})),p(!1)},onCancel:function(){return p(!1)},visible:v})]})}function jn(e){var n=e.visible,t=e.element,a=e.onOk,i=e.onCancel,l=Object(c.useState)(t),u=Object(o.a)(l,2),s=u[0],j=u[1];return Object(c.useEffect)((function(){return j(t)}),[t]),Object(r.jsx)(fe,{title:t.id+" configuration",size:"md",visible:n,onOk:function(){return a(s)},onCancel:function(){return i()},children:Object(r.jsx)(sn,{element:s,onChange:function(e){return j(e)}})})}function dn(e){var n,t,a=e.roadMap,i=e.relevantPoint,l=e.onChange,u=e.crossingLink,d=e.onDelete,b=Object(c.useState)(!1),O=Object(o.a)(b,2),f=O[0],v=O[1],p=(null===a||void 0===a||null===(n=a.lanes)||void 0===n?void 0:n.filter((function(e){return(null===e||void 0===e?void 0:e.destinationId)===i.id})).map((function(e){return e.id})))||[],h=(null===a||void 0===a||null===(t=a.lanes)||void 0===t?void 0:t.filter((function(e){return(null===e||void 0===e?void 0:e.sourceId)===i.id})).map((function(e){return e.id})))||[];return Object(r.jsxs)("div",{className:"flex-row align-center flex-grow justify-space-between",children:[Object(r.jsx)(j.a,{className:"flex-grow",variant:"h6",children:u.id}),Object(r.jsx)(De,{options:p,value:u.sourceId,label:"Source",onSelectOption:function(e){return l(Object(he.a)(Object(he.a)({},u),{},{sourceId:e||""}))}}),Object(r.jsx)(De,{options:h,value:u.destinationId,label:"Destination",onSelectOption:function(e){return l(Object(he.a)(Object(he.a)({},u),{},{destinationId:e||""}))}}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return v(!0)},children:Object(r.jsx)(Fe.a,{})}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return d()},children:Object(r.jsx)(He.a,{})}),Object(r.jsx)(jn,{visible:f,element:u,onOk:function(e){l(e),v(!1)},onCancel:function(){return v(!1)}})]})}function bn(e){var n,t,a,i=e.roadMap,l=e.element,u=e.onChange,d=L().formControl,b=Object(c.useState)(On()),O=Object(o.a)(b,2),f=O[0],v=O[1],p=(null===i||void 0===i||null===(n=i.lanes)||void 0===n?void 0:n.filter((function(e){return e.destinationId===l.id})).map((function(e){return e.id})))||[],h=(null===i||void 0===i||null===(t=i.lanes)||void 0===t?void 0:t.filter((function(e){return e.sourceId===l.id})).map((function(e){return e.id})))||[];function x(e,n){var t;u(Object(he.a)(Object(he.a)({},l),{},{links:null===l||void 0===l||null===(t=l.links)||void 0===t?void 0:t.slice(0,n).concat([e]).concat(l.links.slice(n+1,l.links.length))}))}return Object(r.jsxs)("div",{children:[Object(r.jsx)(j.a,{variant:"h6",children:"New link"}),Object(r.jsxs)("div",{className:"flex-row justify-space-between",children:[Object(r.jsx)(A.a,{className:d,label:"ID",variant:"outlined",value:f.id||"",onChange:function(e){return v(Object(he.a)(Object(he.a)({},f),{},{id:e.target.value}))}}),Object(r.jsx)(De,{options:p,value:f.sourceId,label:"Source",onSelectOption:function(e){return v(Object(he.a)(Object(he.a)({},f),{},{sourceId:e||""}))}}),Object(r.jsx)(De,{options:h,value:f.destinationId,label:"Destination",onSelectOption:function(e){return v(Object(he.a)(Object(he.a)({},f),{},{destinationId:e||""}))}}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){u(Object(he.a)(Object(he.a)({},l),{},{links:[].concat(Object(Ne.a)((null===l||void 0===l?void 0:l.links)||[]),[f])})),v(On())},disabled:!((f.destinationId||f.sourceId)&&f.id&&f.destinationId!==f.sourceId),children:Object(r.jsx)(Ae.a,{})})]}),Object(r.jsx)(j.a,{variant:"h6",children:"Existing links"}),null===l||void 0===l||null===(a=l.links)||void 0===a?void 0:a.map((function(e,n){return Object(r.jsx)("div",{className:"flex-row justify-space-between",children:Object(r.jsx)(dn,{roadMap:i,onDelete:function(){return function(e){var n;u(Object(he.a)(Object(he.a)({},l),{},{links:null===l||void 0===l||null===(n=l.links)||void 0===n?void 0:n.slice(0,e).concat(l.links.slice(e+1,l.links.length))}))}(n)},crossingLink:e,relevantPoint:l,onChange:function(e){return x(e,n)}})},(null===e||void 0===e?void 0:e.id)||""+n)}))]})}function On(){return{id:void 0,configurableType:"CrossingLink",category:"CrossingLink",sourceId:void 0,destinationId:void 0,props:[]}}function fn(e){var n=e.roadMap,t=e.element,a=e.onOk,i=e.onDelete,l=e.onCancel,u=Object(c.useState)(!1),d=Object(o.a)(u,2),b=d[0],O=d[1],f=Object(c.useState)(t),v=Object(o.a)(f,2),p=v[0],h=v[1];return Object(r.jsxs)(fe,{onOk:function(){return a(p)},onCancel:l,visible:!0,children:[Object(r.jsxs)("div",{className:"flex-row align-center",children:[Object(r.jsxs)(j.a,{variant:"h5",children:["Node ",p.id]}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return O(!0)},children:Object(r.jsx)(Fe.a,{})}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return i()},children:Object(r.jsx)(He.a,{})})]}),Object(r.jsx)(bn,{roadMap:n,element:p,onChange:function(e){return h(e)}}),Object(r.jsx)(jn,{visible:b,element:p,onOk:function(e){h(e),O(!1)},onCancel:function(){return O(!1)}})]})}function vn(e){var n=e.roadMap,t=e.element,a=e.onOk,i=e.onDelete,l=e.onCancel,u=Object(c.useState)(!1),d=Object(o.a)(u,2),b=d[0],O=d[1],f=Object(c.useState)(t),v=Object(o.a)(f,2),p=v[0],h=v[1];return Object(r.jsxs)(fe,{onOk:function(){return a(p)},onCancel:l,visible:!0,children:[Object(r.jsxs)("div",{className:"flex-row align-center",children:[Object(r.jsxs)(j.a,{variant:"h5",children:["Lane ",p.id]}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return O(!0)},children:Object(r.jsx)(Fe.a,{})}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return i()},children:Object(r.jsx)(He.a,{})})]}),Object(r.jsxs)("div",{className:"flex-row",children:[Object(r.jsx)(De,{options:Pe(n).map((function(e){return e.id})),value:p.sourceId,label:"Source",onSelectOption:function(e){return h(Object(he.a)(Object(he.a)({},p),{},{sourceId:e||""}))}}),Object(r.jsx)(De,{options:Pe(n).map((function(e){return e.id})),value:p.destinationId,label:"Destination",onSelectOption:function(e){return h(Object(he.a)(Object(he.a)({},p),{},{destinationId:e||""}))}})]}),Object(r.jsx)(jn,{visible:b,element:p,onOk:function(e){h(e),O(!1)},onCancel:function(){return O(!1)}})]})}on.set(Be.INTEGER,(function(e){var n=e.property,t=e.onChange;return Object(r.jsx)(Xe,{property:n,onChange:t})})),on.set(Be.DECIMAL,(function(e){var n=e.property,t=e.onChange;return Object(r.jsx)($e,{property:n,onChange:t})})),on.set(Be.STRING,(function(e){var n=e.property,t=e.onChange;return Object(r.jsx)(Ze,{property:n,onChange:t})})),on.set(Be.CHOICE,(function(e){var n,t=e.property,a=e.onChange,i=L(),l=Object(c.useState)({id:"",label:""}),u=Object(o.a)(l,2),d=u[0],b=u[1];function O(e,n){t&&t.choices&&a(Object(he.a)(Object(he.a)({},t),{},{choices:t.choices.slice(0,e).concat([n]).concat(t.choices.slice(e+1,t.choices.length))}))}return Object(r.jsxs)("div",{children:[Object(r.jsx)(j.a,{variant:"h6",children:"New item"}),Object(r.jsxs)("div",{className:"flex-row justify-space-between",children:[Object(r.jsx)(A.a,{className:i.formControl,label:"ID",variant:"outlined",value:d.id,onChange:function(e){return b(Object(he.a)(Object(he.a)({},d),{},{id:e.target.value}))}}),Object(r.jsx)(A.a,{className:i.formControl,label:"Label",variant:"outlined",value:d.label,onChange:function(e){return b(Object(he.a)(Object(he.a)({},d),{},{label:e.target.value}))}}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){t&&t.choices&&(a(Object(he.a)(Object(he.a)({},t),{},{choices:t.choices.concat([d])})),b({id:"",label:""}))},children:Object(r.jsx)(Ae.a,{})})]}),Object(r.jsx)(j.a,{variant:"h6",children:"Existing choices"}),null===t||void 0===t||null===(n=t.choices)||void 0===n?void 0:n.map((function(e,n){return Object(r.jsxs)("div",{className:"flex-row justify-space-between",children:[Object(r.jsx)(A.a,{className:i.formControl,label:"ID",variant:"outlined",value:e.id,onChange:function(t){return O(n,Object(he.a)(Object(he.a)({},e),{},{id:t.target.value}))}}),Object(r.jsx)(A.a,{className:i.formControl,label:"Label",variant:"outlined",value:e.label,onChange:function(t){return O(n,Object(he.a)(Object(he.a)({},e),{},{label:t.target.value}))}}),Object(r.jsx)(s.a,{color:"primary",onClick:function(){return function(e){t&&t.choices&&a(Object(he.a)(Object(he.a)({},t),{},{choices:t.choices.slice(0,e).concat(t.choices.slice(e+1,t.choices.length))}))}(n)},children:Object(r.jsx)(He.a,{})})]},(null===e||void 0===e?void 0:e.id)||""+n)})),Object(r.jsx)(_e,{property:t,onChange:a})]})})),on.set(Be.DISTRIBUTION,(function(e){var n,t=e.property,a=e.onChange;return Object(r.jsxs)("div",{children:[Object(r.jsx)(De,{options:["UniformDistribution","ExponentialDistribution"],value:(null===t||void 0===t||null===(n=t.value)||void 0===n?void 0:n.distributionType)||null,label:"Type",onSelectOption:function(e){var n;switch(e){case"ExponentialDistribution":n={distributionType:"UniformDistributionType",lambda:1};break;case"UniformDistribution":default:n={distributionType:"UniformDistributionType",left:0,right:1}}a(Object(he.a)(Object(he.a)({},t),{},{value:n}))}}),(null===t||void 0===t?void 0:t.value)&&Object(r.jsx)(tn,{property:t,onChange:a})]})}));var pn=t(128),hn=t.n(pn);function xn(e){var n=e.visible,t=e.onClose,a=e.onChooseAnalysis,i=e.projectId,l=e.mapId,u=Object(c.useContext)(z).analysisApi,s=Object(c.useState)([]),j=Object(o.a)(s,2),d=j[0],b=j[1];return Object(c.useEffect)((function(){i&&l&&u.getAvailableAnalysis(i,l).then((function(e){b(e.data)}))}),[u,i,l]),Object(r.jsxs)(X.a,{onClose:t,open:n,children:[Object(r.jsx)(Z.a,{children:"Choose analysis type"}),Object(r.jsx)(p.a,{children:d.map((function(e){return Object(r.jsxs)(O.a,{button:!0,onClick:function(){return a(e)},children:[Object(r.jsx)(Te.a,{children:Object(r.jsx)(Ee.a,{children:Object(r.jsx)(hn.a,{})})}),Object(r.jsx)(v.a,{primary:e.name})]},e.id)}))})]})}function mn(e){var n=e.projectId,t=e.roadMap,a=e.refresh,i=e.navigate,l=Object(c.useContext)(z).projectsApi,u=Object(c.useCallback)((function(){if(n&&t.uuid)return l.updateMap(n,t.uuid,{map:t}).then((function(){a()}))}),[t,n,l,a]);var s=Object(c.useState)(null),j=Object(o.a)(s,2),b=j[0],O=j[1],f=Object(c.useState)(null),v=Object(o.a)(f,2),p=v[0],h=v[1],x=Object(c.useState)(!1),m=Object(o.a)(x,2),C=m[0],g=m[1],y=Object(c.useState)(!1),k=Object(o.a)(y,2),S=k[0],I=k[1],w=Object(c.useState)(null),N=Object(o.a)(w,2),T=N[0],E=N[1],A=Object(c.useState)(!1),M=Object(o.a)(A,2),D=M[0],P=M[1],U=Object(c.useState)(null),R=Object(o.a)(U,2)[1],L=Object(c.useState)(0),B=Object(o.a)(L,2),W=B[0],G=B[1],F=Object(c.useState)(0),H=Object(o.a)(F,2),J=H[0],V=H[1],q=Object(c.useState)(null),K=Object(o.a)(q,2)[1];function Y(e,n){return e.value||n}var Q=Object(c.useCallback)((function(){if(t&&T)try{var e=Ie()({container:T,elements:{nodes:Pe(t).map((function(e){return{data:{id:e.id},position:{x:Y(we(e.props||[],"x"),0)*T.clientWidth,y:Y(we(e.props||[],"y"),0)*T.clientHeight}}})),edges:Ue(t).map((function(e){return{data:{id:e.id,source:e.sourceId||"",target:e.destinationId||""}}}))},style:[{selector:"node",style:{label:"data(id)"}},{selector:"edge",style:{"mid-target-arrow-shape":"triangle"}}],layout:{name:"preset",fit:!0}});e.on("tapend","node",(function(e){var n=e.target.id(),r=e.target.position(),a=r.x/T.clientWidth,c=r.y/T.clientHeight,i=(t.points||[]).find((function(e){return e.id===n}));if(i){var o=i.props||[],l=we(o,"x"),s=we(o,"y");l.value!==a&&s.value!==c&&(l.value=a,s.value=c,u())}})),e.on("cxttapend ","node",(function(e){setTimeout((function(){var n=e.target.id(),r=((null===t||void 0===t?void 0:t.points)||[]).find((function(e){return e.id===n}));r&&O(r)}),0)})),e.on("cxttapend ","edge",(function(e){setTimeout((function(){var n=e.target.id(),r=((null===t||void 0===t?void 0:t.lanes)||[]).find((function(e){return e.id===n}));r&&h(r)}),0)})),e.on("cxttapend",(function(n){if(n.target===e){var t=n.position;G(t.x/T.clientWidth),V(t.y/T.clientHeight),setTimeout((function(){g(!0)}),0)}})),K(e)}catch(n){console.log("Could not draw network"),console.error(n)}}),[u,T,t]);function X(e){i&&i(e)}return Object(c.useEffect)((function(){Q()}),[Q]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"button-row",children:[Object(r.jsx)(d.a,{variant:"contained",color:"primary",onClick:function(){return P(!0)},children:"Analyze"}),Object(r.jsx)(d.a,{variant:"outlined",color:"primary",onClick:function(){return X("./analysis")},children:"Analysis"}),Object(r.jsx)(d.a,{variant:"outlined",color:"primary",onClick:function(){I(!0),setTimeout(Q,0)},children:"Edit"}),Object(r.jsx)(d.a,{color:"primary",onClick:function(){X("..")},children:"Back"})]}),Object(r.jsxs)("div",{className:"flex-row",children:[t&&Object(r.jsx)("div",{className:"flex-grid network-container",ref:function(e){E(e)}}),S&&Object(r.jsx)("div",{className:"flex-grid",children:Object(r.jsx)(ke,{onClose:function(){I(!1),setTimeout(Q,0)},visible:S,initialJSON:t||{},onChange:u})}),C&&Object(r.jsx)(ze,{roadMap:t,x:W,y:J,onCreateNode:function(e){return function(e){var n,r;null===(n=t.points)||void 0===n||n.push(e),null===(r=u())||void 0===r||r.then((function(){return g(!1)}))}(e)},onCreateLane:function(e){return function(e){var n,r;null===(n=t.lanes)||void 0===n||n.push(e),null===(r=u())||void 0===r||r.then((function(){return g(!1)}))}(e)},onClose:function(){return g(!1)},visible:C}),D&&Object(r.jsx)(xn,{projectId:n,mapId:null===t||void 0===t?void 0:t.uuid,onClose:function(){return P(!1)},onChooseAnalysis:R,visible:D}),b&&Object(r.jsx)(fn,{roadMap:t,onOk:function(e){return function(e){var n,r,a=null===(n=t.points)||void 0===n?void 0:n.findIndex((function(n){return n.id===e.id}));void 0!==a&&a>=0&&t.points&&(t.points[a]=e,null===(r=u())||void 0===r||r.then((function(){return O(null)})))}(e)},onDelete:function(){return function(){var e,n,r,a=null===(e=t.points)||void 0===e?void 0:e.findIndex((function(e){return e.id===(null===b||void 0===b?void 0:b.id)}));void 0!==a&&a>=0&&(null===(n=t.points)||void 0===n||n.splice(a,1),null===(r=u())||void 0===r||r.then((function(){return O(null)})))}()},onCancel:function(){return O(null)},element:b}),p&&Object(r.jsx)(vn,{roadMap:t,onOk:function(e){return function(e){var n,r,a=null===(n=t.lanes)||void 0===n?void 0:n.findIndex((function(n){return n.id===e.id}));void 0!==a&&a>=0&&t.lanes&&(t.lanes[a]=e,null===(r=u())||void 0===r||r.then((function(){return h(null)})))}(e)},onDelete:function(){return function(){var e,n,r,a=null===(e=t.lanes)||void 0===e?void 0:e.findIndex((function(e){return e.id===(null===p||void 0===p?void 0:p.id)}));void 0!==a&&a>=0&&(null===(n=t.lanes)||void 0===n||n.splice(a,1),null===(r=u())||void 0===r||r.then((function(){return h(null)})))}()},onCancel:function(){return h(null)},element:p})]})]})}function Cn(e){var n=e.navigate,t=e.projectId,a=e.mapId,i=Object(c.useContext)(z).projectsApi,l=Object(c.useState)(null),u=Object(o.a)(l,2),s=u[0],j=u[1],d=Object(c.useCallback)((function(){t&&a&&i.getMap(t,a).then((function(e){return j(e.data)}))}),[i,a,t]);return Object(c.useEffect)((function(){d()}),[d]),t&&s?Object(r.jsx)(B,{title:"Map ".concat(null===s||void 0===s?void 0:s.name),children:Object(r.jsx)(mn,{refresh:d,projectId:t,roadMap:s,navigate:n})}):Object(r.jsx)("div",{})}function gn(e){var n=[];return e&&e.roles&&(e.roles.find((function(e){return e===ae.UserRole.Client}))&&n.push(Object(r.jsxs)(O.a,{button:!0,onClick:function(){return Object(I.b)("/tramways/projects")},children:[Object(r.jsx)(f.a,{children:Object(r.jsx)(S.a,{})}),Object(r.jsx)(v.a,{primary:"Projects"})]},"projects")),e.roles.find((function(e){return e===ae.UserRole.Expert}))&&n.push(Object(r.jsxs)(O.a,{button:!0,onClick:function(){return Object(I.b)("/tramways/configurations")},children:[Object(r.jsx)(f.a,{children:Object(r.jsx)(y.a,{})}),Object(r.jsx)(v.a,{primary:"Configurations"})]},"configurations")),e.roles.find((function(e){return e===ae.UserRole.Admin}))&&n.push(Object(r.jsxs)(O.a,{button:!0,onClick:function(){return Object(I.b)("/tramways/users")},children:[Object(r.jsx)(f.a,{children:Object(r.jsx)(x.a,{})}),Object(r.jsx)(v.a,{primary:"Users"})]},"users"))),Object(r.jsx)(p.a,{children:n})}var yn=function(){var e=Object(c.useContext)(w),n=e.error,t=e.clearError,a=e.message,i=e.clearMessage,O=e.loading,f=e.appBarTitle,v=Object(c.useContext)(z).updateToken,p=Object(c.useContext)(oe).user,h=L(),x=Object(c.useState)(!1),m=Object(o.a)(x,2),g=m[0],y=m[1];return Object(c.useEffect)((function(){a&&setTimeout(i,2e3)}),[a,i]),Object(r.jsxs)("div",{className:"App",children:[Object(r.jsx)(l.a,{position:"static",children:Object(r.jsxs)(u.a,{children:[Object(r.jsx)(s.a,{edge:"start",color:"inherit",onClick:function(){return y(!0)},children:Object(r.jsx)(C.a,{})}),Object(r.jsx)(j.a,{variant:"h6",className:h.appBarTitle,children:f}),!p&&Object(r.jsx)(d.a,{color:"inherit",onClick:function(){return Object(I.b)("/tramways/login")},children:"Login"}),p&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)(s.a,{onClick:function(){return Object(I.b)("/tramways/profile")},color:"inherit",children:Object(r.jsx)(ue.a,{})}),Object(r.jsx)(d.a,{color:"inherit",onClick:function(){v("")},children:"Logout"})]})]})}),Object(r.jsx)(b.a,{open:g,onClose:function(){return y(!1)},children:Object(r.jsx)("div",{onClick:function(){return y(!1)},onKeyDown:function(){return y(!1)},children:gn(p)})}),!p&&!O&&Object(r.jsx)(I.a,{basepath:"/tramways",children:Object(r.jsx)(F,{default:!0})}),p&&Object(r.jsxs)(I.a,{basepath:"/tramways",children:[Object(r.jsx)(Oe,{path:"/profile",default:!0}),Object(r.jsx)(pe,{path:"/projects"}),Object(r.jsx)(Ce,{path:"/projects/:projectId"}),Object(r.jsx)(Cn,{path:"/projects/:projectId/:mapId"}),Object(r.jsx)(ie,{path:"/users"})]}),Object(r.jsx)(le,{visible:!!n,onClose:t,children:Object(r.jsx)(j.a,{color:"error",children:n})}),Object(r.jsx)(le,{visible:!!a,children:Object(r.jsx)(j.a,{children:a})})]})},kn=t(86),Sn=t.n(kn),In=t(62),wn=t.n(In),Nn=function(e,n){wn.a.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)})),wn.a.interceptors.response.use((function(e){return Promise.resolve(e)}),(function(t){return t.isAxiosError?t.response?403===t.response.status?n("Please sign in"):t.response.data?t.response.data.value?e(t.response.data.value):t.response.data.error?e(t.response.data.error):e(t.response.data):e("Unexpected error"):t.request?e("Errore durante la comunicazione con il server"):e("Unexpected error"):e("Unexpected error"),Promise.reject(t)}))};function Tn(e){return new ae.UsersApi(new ae.Configuration(e))}var En=t(87);function An(e){return new En.ProjectsApi(new En.Configuration(e))}var Mn=t(88);function Dn(e){return new Mn.AnalysisApi(new Mn.Configuration(e))}function Pn(){var e=Object(c.useState)(""),n=Object(o.a)(e,2),t=n[0],a=n[1],i=Object(c.useState)(""),l=Object(o.a)(i,2),u=l[0],s=l[1],j=Object(c.useState)(0),d=Object(o.a)(j,2),b=d[0],O=d[1],f=Object(c.useState)(""),v=Object(o.a)(f,2),p=v[0],h=v[1],x=Object(c.useCallback)((function(){return a("")}),[]),m=Object(c.useCallback)((function(e){return a(e)}),[]),C=Object(c.useCallback)((function(e){return s(e)}),[]),g=Object(c.useCallback)((function(){return s("")}),[]),y=Object(c.useCallback)((function(){return O((function(e){return e-1}))}),[]),k=Object(c.useCallback)((function(){return O((function(e){return e+1}))}),[]),S=Object(c.useState)(Sn.a.get("authorization")),I=Object(o.a)(S,2),N=I[0],T=I[1],E=Object(c.useState)(null),A=Object(o.a)(E,2),M=A[0],D=A[1];Nn(m,C);var P={accessToken:N,basePath:"http://localhost:8762/tramways/rest"},U=Object(c.useState)(Tn(P)),R=Object(o.a)(U,2),L=R[0],B=R[1],W=Object(c.useState)(An(P)),G=Object(o.a)(W,2),F=G[0],H=G[1],J=Object(c.useState)(Dn(P)),V=Object(o.a)(J,2),q=V[0],K=V[1],Y=Object(c.useState)(!1),Q=Object(o.a)(Y,2),X=Q[0],Z=Q[1],$=Object(c.useCallback)((function(){L.logged().then((function(e){return D(e.data)})).catch((function(){return D(null)})).then((function(){return Z(!0)}))}),[L]),_=Object(c.useCallback)((function(e){T(e),Sn.a.set("authorization",e);var n={accessToken:e,basePath:"http://localhost:8762/tramways/rest"};B(Tn(n)),H(An(n)),K(Dn(n))}),[]);return Object(c.useEffect)((function(){$()}),[$]),X?Object(r.jsx)(w.Provider,{value:{error:t,notifyError:m,clearError:x,message:u,notifyMessage:C,clearMessage:g,loading:b,startLoading:k,stopLoading:y,appBarTitle:p,setAppBarTitle:h},children:Object(r.jsx)(z.Provider,{value:{usersApi:L,projectsApi:F,analysisApi:q,updateToken:_},children:Object(r.jsx)(oe.Provider,{value:{user:M,refreshUser:$},children:Object(r.jsx)(yn,{})})})}):Object(r.jsx)("div",{})}t(301);t(302),a.render(Object(r.jsx)(Pn,{}),document.getElementById("app"))}},[[303,1,2]]]);
//# sourceMappingURL=main.fd9889ef.chunk.js.map